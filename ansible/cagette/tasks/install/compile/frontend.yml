
- name: "[install] - check if frontend code compilation has already been made once"
  become: yes
  stat:
    path: /var/www/cagette/frontend/has_been_compiled.ansible
  register: has_been_compiled
  failed_when: no
  changed_when: no

- block:
  - name: "[install] - compile frontend source code"
    become: yes
    shell: haxe cagetteJs.hxml
    args:
      chdir: /var/www/cagette/frontend
      executable: /bin/bash

  - name: "[install] - register file to tell that frontend has been compiled"
    become: yes
    file:
      state: touch
      path: /var/www/cagette/frontend/has_been_compiled.ansible
  when: not has_been_compiled.stat.exists or (force_cagette_frontend_compilation is defined and force_cagette_frontend_compilation == "yes")
